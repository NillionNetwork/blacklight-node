# Nillion Blacklight Node <a href="https://github.com/NillionNetwork/blacklight/blob/main/LICENSE" target="_blank"><img src="https://img.shields.io/badge/License-MIT-green.svg" alt="MIT License"/></a>

Nillion Blacklight nodes help secure nilCC (Nillion's Confidential Compute layer). Once running, they are continuously assigned work to verify the attestations of live running workloads, running on nilCC, are valid and correct.

## Overview

Nillion Blacklight is a decentralized verification network where nodes verify HTX transactions emitted by nilCC operators. The system uses a smart contract to coordinate node registration, HTX assignment, and verification results.

**How it works:**
1. **nilCC operators** submit HTXs to the `HeartbeatManager` smart contract, which include information about the workload that is being ran.
2. **Smart Contract** randomly assigns HTXs to registered blacklight nodes.
3. **blacklight Nodes** listen to HTX assignment events, verify them and submit the verification result back to the `HeartbeatManager` contract. The verification process involves:
    a. Fetching the attestation report generated by the workload running in nilCC.
    b. Ensuring the attestation report is valid, meaning it's signed by an AMD certificate chain, and contains the expected measurement hash.
    c. Ensuring the measurement hash is included in the builder's trusted measurement hash index.

## How to run a node

Follow these steps to run your own blacklight verification node on the network.


### Prerequisites

1. Install [docker](https://www.docker.com/).
2. Pull the latest blacklight node image.
   ```bash
   docker pull ghcr.io/nillionnetwork/blacklight/blacklight_node:latest
   ```

### Setup & Run

1. Run the node for initial setup:
   ```bash
   docker run -it --rm -v ./:/app/ ghcr.io/nillionnetwork/blacklight/blacklight_node:latest
   ```

   On first run, the node will:
   - Generate a new wallet and save it to `./blacklight_node.env`. **This file contains the node wallets's private key and
   should be backed up**.
   - Display your wallet address and balances.
   - Stop and prompt you to fund your wallet with ETH and stake TEST tokens.

2. Continue to [wallet setup](#wallet-setup-all-options) below to fund your wallet and stake NIL tokens before running
   the node.

### Get ETH and NIL tokens

Ask someone to send you ETH Sepolia and NIL tokens to the address displayed by the node when starting.

### Start the node

After confirming your ETH balance and NIL token stake, start the blacklight node again:

```bash
docker run -it --rm -v ./:/app/ ghcr.io/nillionnetwork/blacklight/blacklight_node:latest
```

This will make the blacklight node start processing HTX transactions, verifying them, and submitting results back to the contract.

For detailed logging, pass `-e RUST_LOG=DEBUG` as an extra parameter to docker, e.g.:

```bash
docker run -e RUST_LOG=DEBUG -it --rm -v ./:/app/ ghcr.io/nillionnetwork/blacklight/blacklight_node:latest
```
